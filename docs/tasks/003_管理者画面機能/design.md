# 管理者画面機能 (Admin Dashboard) 設計書

## 1. ユーザーニーズ
- **オーナー（管理者）**:
  - サービスの利用状況（ユーザー数、問合せ数）を把握したい。
  - 登録ユーザーを管理（権限変更、不適切なユーザーの削除）したい。
  - お問合せ内容を一覧で確認し、対応状況を管理したい。

## 2. 機能要件
### 2.1 アクセス制御
- **管理者権限チェック**:
  - `role: "admin"` のユーザーのみアクセス可能。
  - 一般ユーザーや未ログインユーザーがアクセスした場合は `403 Forbidden` またはログイン画面へリダイレクト。
  - ミドルウェアで `/admin` 配下を保護。

### 2.2 ダッシュボード (`/admin`)
- **統計情報表示**:
  - 総ユーザー数
  - 総お問合せ数
  - (将来的に) 最近の登録ユーザー、未読のお問合せなど

### 2.3 ユーザー管理 (`/admin/users`)
- **ユーザー一覧表示**:
  - 名前、Email、Role、登録日を表示。
  - ページネーション、ソート機能（MUI DataGrid使用）。
- **権限変更**:
  - ユーザーのRoleを `user` <-> `admin` で変更可能。
- **ユーザー削除**:
  - ユーザーを削除可能（確認ダイアログ表示）。

### 2.4 お問合せ管理 (`/admin/contacts`)
- **お問合せ一覧表示**:
  - 名前、Email、件名、受信日時を表示。
  - 詳細表示（モーダルまたは別ページ）。
- **お問合せ削除**:
  - 不要なお問合せを削除可能。

## 3. 技術要件
- **Frontend**:
  - Next.js (App Router)
  - Material UI (MUI)
  - `@mui/x-data-grid` (一覧表示用)
- **Backend (API Routes)**:
  - `/api/admin/stats`: 統計情報取得
  - `/api/admin/users`: ユーザー一覧取得、更新、削除
  - `/api/admin/contacts`: お問合せ一覧取得、削除
- **Database**:
  - MongoDB (Mongoose)
  - `User` モデル、`Contact` モデル

## 4. 画面構成
| パス | 画面名 | 機能 |
| :--- | :--- | :--- |
| `/admin` | ダッシュボード | 統計カード表示 |
| `/admin/users` | ユーザー管理 | DataGridによる一覧、編集・削除アクション |
| `/admin/contacts` | お問合せ管理 | DataGridによる一覧、詳細確認、削除アクション |

## 5. 実装手順
1.  **準備**: `@mui/x-data-grid` のインストール。
2.  **API実装**: 各種管理用APIの作成（権限チェック含む）。
3.  **ミドルウェア更新**: `/admin` ルートの保護ロジック追加。
4.  **画面実装**:
    - AdminLayout (サイドバーまたはヘッダー)
    - Dashboard Page
    - User Management Page
    - Contact Management Page
5.  **導線追加**: ヘッダーに管理者のみ「Admin Dashboard」リンク表示。
